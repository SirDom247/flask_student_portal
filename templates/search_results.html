{% extends "base.html" %}
{% block title %}Advanced Results Search - PDE Portal{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-gray-900 to-black py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        
        <!-- Header Card -->
        <div class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl p-6 border border-gray-700 mb-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl flex items-center justify-center">
                        <i class="fas fa-filter text-white text-lg"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-white">Advanced Results Search</h1>
                        <p class="text-gray-400">Search and filter student results with multiple criteria</p>
                    </div>
                </div>
                <a href="{{ url_for('dashboard_officer') }}" 
                   class="bg-gradient-to-r from-gray-700 to-gray-800 text-white px-4 py-2 rounded-xl hover:bg-gray-600 transition-all duration-300 flex items-center">
                    <i class="fas fa-arrow-left mr-2"></i> Back to Dashboard
                </a>
            </div>
        </div>

        <!-- Search Filters Card -->
        <div class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl p-6 border border-gray-700 mb-6">
            <form method="GET" action="{{ url_for('search_results') }}" class="space-y-6" id="searchForm">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <!-- First Row of Filters -->
                <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                    <!-- Matric Number -->
                    <div>
                        <label for="matric_no" class="block text-sm font-medium text-gray-300 mb-2">Matric Number</label>
                        <input type="text" id="matric_no" name="matric_no" 
                               value="{{ request.args.get('matric_no', '') }}" 
                               placeholder="e.g., CS2025001"
                               list="matricSuggestions"
                               class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300">
                        <datalist id="matricSuggestions">
                            {% for student in stats.students %}
                            <option value="{{ student.matric_no }}">
                            {% endfor %}
                        </datalist>
                    </div>
                    
                    <!-- Course Code -->
                    <div>
                        <label for="course_code" class="block text-sm font-medium text-gray-300 mb-2">Course Code</label>
                        <input type="text" id="course_code" name="course_code"
                               value="{{ request.args.get('course_code', '') }}"
                               placeholder="e.g., CSC101"
                               list="courseSuggestions"
                               class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300">
                        <datalist id="courseSuggestions">
                            {% for course in all_courses %}
                            <option value="{{ course }}">
                            {% endfor %}
                        </datalist>
                    </div>
                    
                    <!-- Grade -->
                    <div>
                        <label for="grade" class="block text-sm font-medium text-gray-300 mb-2">Grade</label>
                        <select id="grade" name="grade" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300">
                            <option value="">All Grades</option>
                            {% for grade in all_grades %}
                            <option value="{{ grade }}" {% if request.args.get('grade') == grade %}selected{% endif %}>
                                {{ grade }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <!-- Min Score -->
                    <div>
                        <label for="min_score" class="block text-sm font-medium text-gray-300 mb-2">Min Score</label>
                        <input type="number" id="min_score" name="min_score"
                               value="{{ request.args.get('min_score', '') }}" min="0" max="100" step="0.1"
                               placeholder="0"
                               class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300">
                    </div>
                    
                    <!-- Max Score -->
                    <div>
                        <label for="max_score" class="block text-sm font-medium text-gray-300 mb-2">Max Score</label>
                        <input type="number" id="max_score" name="max_score"
                               value="{{ request.args.get('max_score', '') }}" min="0" max="100" step="0.1"
                               placeholder="100"
                               class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300">
                    </div>
                </div>

                <!-- Second Row of Filters -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <!-- Semester -->
                    <div>
                        <label for="semester" class="block text-sm font-medium text-gray-300 mb-2">Semester</label>
                        <select id="semester" name="semester" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300">
                            <option value="">All Semesters</option>
                            <option value="1" {% if request.args.get('semester') == '1' %}selected{% endif %}>First Semester</option>
                            <option value="2" {% if request.args.get('semester') == '2' %}selected{% endif %}>Second Semester</option>
                            <option value="3" {% if request.args.get('semester') == '3' %}selected{% endif %}>Third Semester</option>
                        </select>
                    </div>
                    
                    <!-- Academic Session -->
                    <div>
                        <label for="academic_session" class="block text-sm font-medium text-gray-300 mb-2">Academic Session</label>
                        <select id="academic_session" name="academic_session" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300">
                            <option value="">All Sessions</option>
                            {% for session in all_sessions %}
                            <option value="{{ session }}" {% if request.args.get('academic_session') == session %}selected{% endif %}>
                                {{ session }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <!-- Date From -->
                    <div>
                        <label for="date_from" class="block text-sm font-medium text-gray-300 mb-2">From Date</label>
                        <input type="date" id="date_from" name="date_from"
                               value="{{ request.args.get('date_from', '') }}"
                               class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300">
                    </div>
                    
                    <!-- Date To -->
                    <div>
                        <label for="date_to" class="block text-sm font-medium text-gray-300 mb-2">To Date</label>
                        <input type="date" id="date_to" name="date_to"
                               value="{{ request.args.get('date_to', '') }}"
                               class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300">
                    </div>
                </div>

                <!-- Third Row of Filters -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Result Status -->
                    <div>
                        <label for="result_status" class="block text-sm font-medium text-gray-300 mb-2">Result Status</label>
                        <select id="result_status" name="result_status" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300">
                            <option value="">All Results</option>
                            <option value="passed" {% if request.args.get('result_status') == 'passed' %}selected{% endif %}>Pass (A-E / â‰¥40)</option>
                            <option value="failed" {% if request.args.get('result_status') == 'failed' %}selected{% endif %}>Fail (F / <40)</option>
                        </select>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex flex-wrap gap-3 pt-4 border-t border-gray-700">
                    <button type="submit" class="bg-gradient-to-r from-blue-600 to-blue-700 text-white px-6 py-3 rounded-xl font-semibold hover:shadow-2xl transition-all duration-300 hover:scale-105 transform flex items-center">
                        <i class="fas fa-search mr-2"></i> Search Results
                    </button>
                    <button type="button" onclick="exportSearchResults()" class="bg-gradient-to-r from-green-600 to-green-700 text-white px-6 py-3 rounded-xl font-semibold hover:shadow-2xl transition-all duration-300 hover:scale-105 transform flex items-center">
                        <i class="fas fa-download mr-2"></i> Export Results
                    </button>
                    <a href="{{ url_for('search_results') }}" class="bg-gradient-to-r from-gray-600 to-gray-700 text-white px-6 py-3 rounded-xl font-semibold hover:shadow-2xl transition-all duration-300 hover:scale-105 transform flex items-center">
                        <i class="fas fa-refresh mr-2"></i> Clear Filters
                    </a>
                    <button type="button" onclick="saveSearch()" class="bg-gradient-to-r from-purple-600 to-purple-700 text-white px-6 py-3 rounded-xl font-semibold hover:shadow-2xl transition-all duration-300 hover:scale-105 transform flex items-center">
                        <i class="fas fa-save mr-2"></i> Save Search
                    </button>
                </div>
            </form>
        </div>

        <!-- Quick Stats -->
        {% if results %}
        <div class="bg-gradient-to-br from-blue-900 to-blue-800 rounded-2xl p-6 border border-blue-700 mb-6">
            <div class="grid grid-cols-2 md:grid-cols-6 gap-4 text-center">
                <div>
                    <div class="text-2xl font-bold text-white">
                        {% if pagination %}
                            {{ pagination.total }}
                        {% else %}
                            {{ results|length }}
                        {% endif %}
                    </div>
                    <div class="text-blue-200 text-sm">Total Results</div>
                </div>
                <div>
                    <div class="text-2xl font-bold text-white">{{ results|selectattr('score', '>=', 40)|list|length }}</div>
                    <div class="text-blue-200 text-sm">Passed</div>
                </div>
                <div>
                    <div class="text-2xl font-bold text-white">{{ results|selectattr('score', '<', 40)|list|length }}</div>
                    <div class="text-blue-200 text-sm">Failed</div>
                </div>
                <div>
                    <div class="text-2xl font-bold text-white">
                        {% if results|length > 0 %}
                            {{ "%.2f"|format(results|map(attribute='score')|sum / results|length) }}
                        {% else %}
                            0.00
                        {% endif %}
                    </div>
                    <div class="text-blue-200 text-sm">Avg Score</div>
                </div>
                <div>
                    <div class="text-2xl font-bold text-white">
                        {% if results|length > 0 %}
                            {{ "%.1f"|format((results|selectattr('score', '>=', 40)|list|length / results|length * 100)) }}%
                        {% else %}
                            0%
                        {% endif %}
                    </div>
                    <div class="text-blue-200 text-sm">Pass Rate</div>
                </div>
                <div>
                    <div class="text-2xl font-bold text-white">{{ all_courses|length }}</div>
                    <div class="text-blue-200 text-sm">Courses</div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Search Results -->
        <div class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl p-6 border border-gray-700">
            {% if results %}
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-bold text-white flex items-center">
                    <i class="fas fa-list-alt text-blue-400 mr-3"></i>
                    Search Results
                </h2>
                <div class="flex items-center space-x-4">
                    <!-- Pagination Info -->
                    {% if pagination %}
                    <span class="bg-purple-500 bg-opacity-20 text-purple-400 px-3 py-1 rounded-full text-sm font-medium">
                        Page {{ pagination.page }} of {{ pagination.pages }}
                    </span>
                    {% endif %}
                    <span class="bg-blue-500 bg-opacity-20 text-blue-400 px-3 py-1 rounded-full text-sm font-medium">
                        {% if pagination %}
                            {{ pagination.total }} total results
                        {% else %}
                            {{ results|length }} results found
                        {% endif %}
                    </span>
                </div>
            </div>

            <!-- Items Per Page Selector -->
            {% if pagination and pagination.pages > 1 %}
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center space-x-4">
                    <span class="text-gray-400 text-sm">Items per page:</span>
                    <select onchange="updatePerPage(this.value)" 
                            class="bg-gray-700 border border-gray-600 rounded-lg px-3 py-1 text-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="10" {% if per_page == 10 %}selected{% endif %}>10</option>
                        <option value="20" {% if per_page == 20 %}selected{% endif %}>20</option>
                        <option value="50" {% if per_page == 50 %}selected{% endif %}>50</option>
                        <option value="100" {% if per_page == 100 %}selected{% endif %}>100</option>
                    </select>
                </div>
                <div class="text-gray-400 text-sm">
                    Showing {{ pagination.first }} to {{ pagination.last }} of {{ pagination.total }} results
                </div>
            </div>
            {% endif %}

            <div class="overflow-x-auto">
                <table class="w-full text-white" id="resultsTable">
                    <thead>
                        <tr class="border-b border-gray-700">
                            <th class="py-4 px-4 text-left font-semibold text-gray-300 cursor-pointer hover:text-white transition-colors sortable" data-column="0">
                                # <i class="fas fa-sort ml-1 text-gray-400 sort-icon"></i>
                            </th>
                            <th class="py-4 px-4 text-left font-semibold text-gray-300 cursor-pointer hover:text-white transition-colors sortable" data-column="1">
                                Matric No <i class="fas fa-sort ml-1 text-gray-400 sort-icon"></i>
                            </th>
                            <th class="py-4 px-4 text-left font-semibold text-gray-300 cursor-pointer hover:text-white transition-colors sortable" data-column="2">
                                Student Name <i class="fas fa-sort ml-1 text-gray-400 sort-icon"></i>
                            </th>
                            <th class="py-4 px-4 text-left font-semibold text-gray-300 cursor-pointer hover:text-white transition-colors sortable" data-column="3">
                                Course <i class="fas fa-sort ml-1 text-gray-400 sort-icon"></i>
                            </th>
                            <th class="py-4 px-4 text-left font-semibold text-gray-300 cursor-pointer hover:text-white transition-colors sortable" data-column="4">
                                Score <i class="fas fa-sort ml-1 text-gray-400 sort-icon"></i>
                            </th>
                            <th class="py-4 px-4 text-left font-semibold text-gray-300 cursor-pointer hover:text-white transition-colors sortable" data-column="5">
                                Grade <i class="fas fa-sort ml-1 text-gray-400 sort-icon"></i>
                            </th>
                            <th class="py-4 px-4 text-left font-semibold text-gray-300 cursor-pointer hover:text-white transition-colors sortable" data-column="6">
                                Session <i class="fas fa-sort ml-1 text-gray-400 sort-icon"></i>
                            </th>
                            <th class="py-4 px-4 text-left font-semibold text-gray-300 cursor-pointer hover:text-white transition-colors sortable" data-column="7">
                                Semester <i class="fas fa-sort ml-1 text-gray-400 sort-icon"></i>
                            </th>
                            <th class="py-4 px-4 text-left font-semibold text-gray-300 cursor-pointer hover:text-white transition-colors sortable" data-column="8">
                                Credit <i class="fas fa-sort ml-1 text-gray-400 sort-icon"></i>
                            </th>
                            <th class="py-4 px-4 text-left font-semibold text-gray-300 cursor-pointer hover:text-white transition-colors sortable" data-column="9">
                                CGPA <i class="fas fa-sort ml-1 text-gray-400 sort-icon"></i>
                            </th>
                            <th class="py-4 px-4 text-left font-semibold text-gray-300 cursor-pointer hover:text-white transition-colors sortable" data-column="10">
                                Date <i class="fas fa-sort ml-1 text-gray-400 sort-icon"></i>
                            </th>
                            <th class="py-4 px-4 text-left font-semibold text-gray-300">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for result in results %}
                        <tr class="border-b border-gray-700 hover:bg-gray-750 transition-colors duration-200">
                            <td class="py-4 px-4 text-gray-300">
                                {% if pagination %}
                                    {{ pagination.first - 1 + loop.index }}
                                {% else %}
                                    {{ loop.index }}
                                {% endif %}
                            </td>
                            <td class="py-4 px-4">
                                <strong class="text-white">{{ result.matric_no }}</strong>
                            </td>
                            <td class="py-4 px-4 text-white">{{ result.student_name }}</td>
                            <td class="py-4 px-4">
                                <div>
                                    <strong class="text-blue-400">{{ result.course_code }}</strong>
                                    <br>
                                    <small class="text-gray-400">{{ result.course_title[:30] }}{% if result.course_title|length > 30 %}...{% endif %}</small>
                                </div>
                            </td>
                            <td class="py-4 px-4">
                                <span class="px-3 py-1 rounded-full text-sm font-medium {% if result.score >= 40 %}bg-green-500 bg-opacity-20 text-green-400{% else %}bg-red-500 bg-opacity-20 text-red-400{% endif %}">
                                    {{ "%.1f"|format(result.score) }}
                                </span>
                            </td>
                            <td class="py-4 px-4">
                                <span class="px-3 py-1 rounded-full text-sm font-bold grade-badge grade-{{ result.grade }}">
                                    {{ result.grade }}
                                </span>
                            </td>
                            <td class="py-4 px-4">
                                <span class="px-2 py-1 bg-purple-500 bg-opacity-20 text-purple-400 rounded-lg text-xs font-medium">
                                    {{ result.academic_session }}
                                </span>
                            </td>
                            <td class="py-4 px-4">
                                <span class="px-2 py-1 bg-blue-500 bg-opacity-20 text-blue-400 rounded-lg text-xs font-medium">
                                    {{ result.semester }}
                                </span>
                            </td>
                            <td class="py-4 px-4">
                                <span class="px-3 py-1 rounded-full text-sm font-medium bg-gray-600 text-gray-300">
                                    {{ result.credit_unit }}
                                </span>
                            </td>
                            <td class="py-4 px-4 font-mono text-purple-400">{{ "%.2f"|format(result.semester_cgpa) }}</td>
                            <td class="py-4 px-4 text-sm text-gray-400">{{ result.date_uploaded.strftime('%Y-%m-%d') }}</td>
                            <td class="py-4 px-4">
                                <div class="flex space-x-2">
                                    <a href="{{ url_for('edit_result', result_id=result.id) }}" 
                                       class="bg-yellow-500 bg-opacity-20 text-yellow-400 px-3 py-2 rounded-lg hover:bg-yellow-500 hover:bg-opacity-30 transition-all duration-300 flex items-center"
                                       title="Edit Result">
                                        <i class="fas fa-edit text-sm"></i>
                                    </a>
                                    <form method="POST" action="{{ url_for('delete_result', result_id=result.id) }}" class="inline">
                                        <button type="submit" 
                                                class="bg-red-500 bg-opacity-20 text-red-400 px-3 py-2 rounded-lg hover:bg-red-500 hover:bg-opacity-30 transition-all duration-300 flex items-center"
                                                title="Delete Result"
                                                onclick="return confirm('Are you sure you want to delete this result?');">
                                            <i class="fas fa-trash text-sm"></i>
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- Pagination Controls -->
            {% if pagination and pagination.pages > 1 %}
            <div class="mt-8 flex items-center justify-between border-t border-gray-700 pt-6">
                <!-- Mobile Pagination -->
                <div class="flex flex-1 justify-between sm:hidden">
                    {% if pagination.has_prev %}
                    <a href="{{ build_pagination_url(pagination.prev_num, per_page) }}" 
                       class="relative inline-flex items-center px-4 py-2 text-sm font-medium text-gray-300 bg-gray-700 border border-gray-600 rounded-lg hover:bg-gray-600 transition-colors">
                        Previous
                    </a>
                    {% else %}
                    <span class="relative inline-flex items-center px-4 py-2 text-sm font-medium text-gray-500 bg-gray-800 border border-gray-700 rounded-lg cursor-not-allowed">
                        Previous
                    </span>
                    {% endif %}
                    
                    {% if pagination.has_next %}
                    <a href="{{ build_pagination_url(pagination.next_num, per_page) }}" 
                       class="relative inline-flex items-center px-4 py-2 ml-3 text-sm font-medium text-gray-300 bg-gray-700 border border-gray-600 rounded-lg hover:bg-gray-600 transition-colors">
                        Next
                    </a>
                    {% else %}
                    <span class="relative inline-flex items-center px-4 py-2 ml-3 text-sm font-medium text-gray-500 bg-gray-800 border border-gray-700 rounded-lg cursor-not-allowed">
                        Next
                    </span>
                    {% endif %}
                </div>

                <!-- Desktop Pagination -->
                <div class="hidden sm:flex sm:flex-1 sm:items-center sm:justify-between">
                    <div>
                        <p class="text-sm text-gray-400">
                            Showing <span class="font-medium text-white">{{ pagination.first }}</span> to 
                            <span class="font-medium text-white">{{ pagination.last }}</span> of 
                            <span class="font-medium text-white">{{ pagination.total }}</span> results
                        </p>
                    </div>
                    <div>
                        <nav class="isolate inline-flex -space-x-px rounded-lg shadow-sm" aria-label="Pagination">
                            <!-- Previous Page -->
                            {% if pagination.has_prev %}
                            <a href="{{ build_pagination_url(pagination.prev_num, per_page) }}" 
                               class="relative inline-flex items-center px-3 py-2 text-sm font-semibold text-gray-300 bg-gray-700 border border-gray-600 rounded-l-lg hover:bg-gray-600 transition-colors">
                                <span class="sr-only">Previous</span>
                                <i class="fas fa-chevron-left"></i>
                            </a>
                            {% else %}
                            <span class="relative inline-flex items-center px-3 py-2 text-sm font-semibold text-gray-500 bg-gray-800 border border-gray-700 rounded-l-lg cursor-not-allowed">
                                <i class="fas fa-chevron-left"></i>
                            </span>
                            {% endif %}

                            <!-- Page Numbers -->
                            {% for page_num in pagination.iter_pages(left_edge=2, left_current=2, right_current=2, right_edge=2) %}
                                {% if page_num %}
                                    {% if page_num == pagination.page %}
                                    <span class="relative inline-flex items-center px-4 py-2 text-sm font-semibold text-white bg-blue-600 border border-blue-500">
                                        {{ page_num }}
                                    </span>
                                    {% else %}
                                    <a href="{{ build_pagination_url(page_num, per_page) }}" 
                                       class="relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-300 bg-gray-700 border border-gray-600 hover:bg-gray-600 transition-colors">
                                        {{ page_num }}
                                    </a>
                                    {% endif %}
                                {% else %}
                                    <span class="relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-500 bg-gray-800 border border-gray-700">
                                        ...
                                    </span>
                                {% endif %}
                            {% endfor %}

                            <!-- Next Page -->
                            {% if pagination.has_next %}
                            <a href="{{ build_pagination_url(pagination.next_num, per_page) }}" 
                               class="relative inline-flex items-center px-3 py-2 text-sm font-semibold text-gray-300 bg-gray-700 border border-gray-600 rounded-r-lg hover:bg-gray-600 transition-colors">
                                <span class="sr-only">Next</span>
                                <i class="fas fa-chevron-right"></i>
                            </a>
                            {% else %}
                            <span class="relative inline-flex items-center px-3 py-2 text-sm font-semibold text-gray-500 bg-gray-800 border border-gray-700 rounded-r-lg cursor-not-allowed">
                                <i class="fas fa-chevron-right"></i>
                            </span>
                            {% endif %}
                        </nav>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Results Footer -->
            <div class="flex justify-between items-center mt-6 pt-6 border-t border-gray-700">
                <div class="text-gray-400 text-sm">
                    {% if pagination %}
                        Showing {{ results|length }} results on this page
                    {% else %}
                        Showing {{ results|length }} results
                    {% endif %}
                </div>
                <div class="flex gap-3">
                    <button onclick="printResults()" 
                            class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-all duration-300 flex items-center">
                        <i class="fas fa-print mr-2"></i>Print
                    </button>
                    <button onclick="scrollToTop()" class="bg-gradient-to-r from-gray-600 to-gray-700 text-white px-4 py-2 rounded-lg hover:shadow-lg transition-all duration-300 flex items-center">
                        <i class="fas fa-arrow-up mr-2"></i> Back to Top
                    </button>
                </div>
            </div>

            {% elif request.args %}
            <!-- No Results State -->
            <div class="text-center py-12">
                <div class="w-20 h-20 bg-blue-500 bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-search text-blue-400 text-2xl"></i>
                </div>
                <h3 class="text-xl font-semibold text-white mb-2">No results found</h3>
                <p class="text-gray-400 mb-6">Try adjusting your search criteria or check for typos</p>
                <a href="{{ url_for('search_results') }}" class="bg-gradient-to-r from-blue-600 to-blue-700 text-white px-6 py-3 rounded-xl font-semibold hover:shadow-xl transition-all duration-300 inline-flex items-center">
                    <i class="fas fa-refresh mr-2"></i> Clear Search
                </a>
            </div>

            {% else %}
            <!-- Initial State -->
            <div class="text-center py-12">
                <div class="w-20 h-20 bg-gray-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-filter text-gray-400 text-2xl"></i>
                </div>
                <h3 class="text-xl font-semibold text-white mb-2">Ready to Search</h3>
                <p class="text-gray-400">Use the filters above to search for student results by various criteria</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- JavaScript -->
<script>
function exportSearchResults() {
    const params = new URLSearchParams(window.location.search);
    params.set('export', 'true');
    const exportUrl = `${window.location.pathname}?${params.toString()}`;
    window.location.href = exportUrl;
}

function saveSearch() {
    const searchParams = new URLSearchParams(window.location.search);
    const searchString = searchParams.toString();
    localStorage.setItem('lastSearch', searchString);
    
    // Show toast notification
    showNotification('Search criteria saved!', 'success');
}

function loadSavedSearch() {
    const savedSearch = localStorage.getItem('lastSearch');
    if (savedSearch) {
        if (confirm('Load your last saved search?')) {
            window.location.href = `${window.location.pathname}?${savedSearch}`;
        }
    } else {
        showNotification('No saved search found.', 'info');
    }
}

function scrollToTop() {
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function printResults() {
    window.print();
}

function showNotification(message, type) {
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `fixed top-4 right-4 px-6 py-3 rounded-xl shadow-lg border transform transition-all duration-300 ${
        type === 'success' ? 'bg-green-900 bg-opacity-20 text-green-400 border-green-800' :
        type === 'error' ? 'bg-red-900 bg-opacity-20 text-red-400 border-red-800' :
        'bg-blue-900 bg-opacity-20 text-blue-400 border-blue-800'
    }`;
    notification.innerHTML = `
        <div class="flex items-center space-x-3">
            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
            <span>${message}</span>
        </div>
    `;
    
    document.body.appendChild(notification);
    
    // Remove after 3 seconds
    setTimeout(() => {
        notification.remove();
    }, 3000);
}

// Update items per page
function updatePerPage(value) {
    const url = new URL(window.location.href);
    url.searchParams.set('per_page', value);
    url.searchParams.set('page', 1); // Reset to first page
    window.location.href = url.toString();
}

// Enhanced table sorting with visual indicators
document.addEventListener('DOMContentLoaded', function() {
    const sortableHeaders = document.querySelectorAll('.sortable');
    let currentSort = { column: null, direction: 'asc' };
    
    sortableHeaders.forEach(header => {
        header.addEventListener('click', function() {
            const columnIndex = parseInt(this.getAttribute('data-column'));
            sortTable(columnIndex);
        });
    });
    
    function sortTable(columnIndex) {
        const table = document.getElementById('resultsTable');
        const tbody = table.querySelector('tbody');
        const rows = Array.from(tbody.querySelectorAll('tr'));
        const isNumeric = columnIndex === 0 || columnIndex === 4 || columnIndex === 8 || columnIndex === 9;
        
        // Determine sort direction
        const direction = currentSort.column === columnIndex && currentSort.direction === 'asc' ? 'desc' : 'asc';
        
        rows.sort((a, b) => {
            let aValue = a.cells[columnIndex].textContent.trim();
            let bValue = b.cells[columnIndex].textContent.trim();
            
            // Handle numeric columns
            if (isNumeric) {
                const aNum = parseFloat(aValue) || 0;
                const bNum = parseFloat(bValue) || 0;
                return direction === 'asc' ? aNum - bNum : bNum - aNum;
            }
            
            // Handle text columns
            if (direction === 'asc') {
                return aValue.localeCompare(bValue);
            } else {
                return bValue.localeCompare(aValue);
            }
        });
        
        // Update table with sorted rows
        tbody.innerHTML = '';
        rows.forEach(row => tbody.appendChild(row));
        
        // Update sort indicators
        updateSortIndicators(columnIndex, direction);
        
        // Store current sort state
        currentSort = { column: columnIndex, direction };
    }
    
    function updateSortIndicators(columnIndex, direction) {
        const sortableHeaders = document.querySelectorAll('.sortable');
        const sortIcons = document.querySelectorAll('.sort-icon');
        
        // Reset all icons
        sortIcons.forEach(icon => {
            icon.className = 'fas fa-sort ml-1 text-gray-400 sort-icon';
        });
        
        // Update the active column icon
        const activeHeader = document.querySelector(`.sortable[data-column="${columnIndex}"]`);
        if (activeHeader) {
            const activeIcon = activeHeader.querySelector('.sort-icon');
            if (direction === 'asc') {
                activeIcon.className = 'fas fa-sort-up ml-1 text-blue-400 sort-icon';
            } else {
                activeIcon.className = 'fas fa-sort-down ml-1 text-blue-400 sort-icon';
            }
        }
    }
    
    // Auto-submit form when certain fields change
    const autoSubmitFields = ['grade', 'semester', 'result_status', 'academic_session'];
    autoSubmitFields.forEach(field => {
        const element = document.getElementById(field);
        if (element) {
            element.addEventListener('change', function() {
                this.form.submit();
            });
        }
    });
    
    // Check for saved search on page load
    const currentParams = new URLSearchParams(window.location.search);
    if (!currentParams.toString() && localStorage.getItem('lastSearch')) {
        // Show load saved search button
        const loadBtn = document.createElement('button');
        loadBtn.className = 'fixed top-20 right-4 bg-purple-600 text-white px-4 py-2 rounded-lg shadow-lg hover:bg-purple-700 transition-colors z-50';
        loadBtn.innerHTML = '<i class="fas fa-history mr-2"></i>Load Saved Search';
        loadBtn.onclick = loadSavedSearch;
        document.body.appendChild(loadBtn);
    }
});
</script>

<style>
.grade-badge {
    min-width: 40px;
    display: inline-block;
    text-align: center;
    color: white;
    font-weight: bold;
}
.grade-A { background-color: #10b981; } /* Green */
.grade-B { background-color: #3b82f6; } /* Blue */
.grade-C { background-color: #8b5cf6; } /* Purple */
.grade-D { background-color: #ec4899; } /* Pink */
.grade-E { background-color: #f59e0b; } /* Yellow */
.grade-F { background-color: #ef4444; } /* Red */

.hover\:bg-gray-750:hover {
    background-color: rgba(55, 65, 81, 0.5);
}

/* Smooth transitions for table interactions */
#resultsTable tr {
    transition: all 0.2s ease-in-out;
}

#resultsTable th:hover {
    background-color: rgba(55, 65, 81, 0.3);
}

.sortable {
    position: relative;
    user-select: none;
}

.sortable:hover {
    background-color: rgba(55, 65, 81, 0.3);
}

.sort-icon {
    transition: all 0.2s ease-in-out;
    font-size: 0.8em;
}

@media print {
    .no-print {
        display: none !important;
    }
}
</style>
{% endblock %}